# Nested Form Builder ユーザーマニュアル

**バージョン**: 2.2
**最終更新**: 2026年2月15日

---

## 目次

1. [はじめに](#はじめに)
2. [基本的な使い方](#基本的な使い方)
3. [フォームエディタの使い方](#フォームエディタの使い方)
4. [高度な機能](#高度な機能)
5. [回答の管理](#回答の管理)
6. [よくある質問](#よくある質問)
7. [トラブルシューティング](#トラブルシューティング)

---

## はじめに

### Nested Form Builderとは

Nested Form Builderは、階層構造を持つアンケートフォームを視覚的に作成できるWebアプリケーションです。プログラミングの知識がなくても、直感的な操作でフォームを作成し、回答をGoogle Sheetsに自動保存できます。

### 主な機能

- ✅ **ビジュアルエディタ**: 直感的な操作で簡単にフォームを作成
- ✅ **ネスト構造**: 条件に応じて次の質問を表示（最大6階層）
- ✅ **多様な質問タイプ**: テキスト、数値、日付、選択肢、チェックボックス、メッセージなど
- ✅ **Google Sheets連携**: 回答を自動的にスプレッドシートに保存
- ✅ **スタンドアロンHTML出力**: 生成されたフォームは単一のHTMLファイルとして配布可能
- ✅ **高度な検索機能**: AND/OR検索、比較演算、正規表現をサポート
- ✅ **データ管理**: インポート・エクスポート、アーカイブ機能
- ✅ **スタイル設定**: フィールドごとに文字サイズ・色をカスタマイズ可能
- ✅ **表示モード**: 通常/コンパクト/非表示の3種類のモード
- ✅ **パフォーマンス最適化**: IndexedDBキャッシュによる高速データ取得

### システム要件

- **ブラウザ**: Google Chrome、Firefox、Safari、Edge（最新版推奨）
- **Googleアカウント**: Google Sheetsにデータを保存するために必要
- **インターネット接続**: フォームの保存・取得時に必要

---

## 基本的な使い方

### 1. アプリケーションへのアクセス

Nested Form Builderは、Google Apps ScriptでデプロイされたWebアプリケーションです。

**アクセス方法**:
1. 管理者から提供されたWebアプリURLにアクセス
   - 例: `https://script.google.com/macros/s/AKfycbz_Efghn21JVp7WU8MuMZrdqEl1ylS9po1Se1UUtz_NDRdFDNVqwzgsayMx7ig5Mezg/exec`
2. または、プロジェクトルートの `.gas-deployment.json` ファイルで確認できます

> **💡 ヒント**: URLをブックマークしておくと、次回から簡単にアクセスできます。

### 2. 初回起動

ブラウザでNested Form Builderにアクセスすると、以下のようなメイン画面（フォーム一覧）が表示されます。

![フォーム一覧画面](screenshot_04_current.png)

- 「管理画面へ」ボタンをクリックすると、フォーム管理画面に移動します
- 作成済みのフォームがある場合は、カード形式で一覧表示されます
- 各フォームカードをクリックすると、検索画面に移動します

### 3. 設定画面

フォーム一覧画面の左サイドバーにある「設定」ボタンをクリックすると、アプリケーション設定画面が表示されます。

![設定画面](screenshot_05_settings.png)

**設定画面でできること**:

#### テーマ設定
- アプリケーションの外観テーマを選択できます
- デフォルトは「Standard」テーマ

#### テーマをインポート
- Google DriveまたはローカルのCSSファイルURLを指定して、カスタムテーマをインポート
- URLを入力して「インポート」ボタンをクリック

#### アクセス制御
- **管理者キー**: 管理者権限でアクセスするためのキーを設定
  - 設定した場合、URLパラメーター `?adminkey=キー` でアクセスした場合のみ管理者として認識
  - 空欄の場合は誰でも管理者としてアクセス可能
- 「保存」ボタンで設定を保存

#### システム情報
- 最終デプロイ日時を確認できます

### 4. 管理画面（フォーム管理画面）

「管理画面へ」ボタンをクリックすると、フォーム管理画面が表示されます。

![フォーム管理画面](screenshot_06_form_editor.png)

#### 画面の構成

**左サイドバーのアクションボタン**:
- **戻る**: フォーム一覧ページに戻ります
- **新規作成**: 新しいフォームを最初から作成
- **インポート**: JSON形式で保存されたフォームをインポート
- **エクスポート**: 現在のフォームをJSON形式でダウンロード
- **アーカイブ**: 使用していないフォームをアーカイブ化
- **削除**: 不要なフォームを完全削除（慎重に使用）
- **更新**: 一覧表示を最新の状態に更新

**メインエリア**:
- フォーム一覧テーブル（名称、フォームID、更新日時、表示項目、公開状態など）
- 各フォームの詳細情報を確認できます

#### 各ボタンの詳細説明

**新規作成**:
- 新しいフォームを作成します
- フォーム編集画面が開きます

**インポート**:
- 以前エクスポートしたJSON形式のフォームファイルを読み込みます
- 既存のフォームと同じIDの場合、上書き確認が表示されます
- バックアップからの復元や、他の環境からのフォーム移行に便利です

**エクスポート**:
- 選択したフォームをJSON形式でダウンロードします
- バックアップとして保存したり、他の環境に移行したりできます

**アーカイブ**:
- 使用しなくなったフォームを非表示にします
- データは残りますが、フォーム一覧には表示されなくなります
- 完全削除よりも安全な方法です

**削除**:
- 選択したフォームを完全に削除します
- 削除したフォームは復元できません
- 関連する回答データには影響しません（Google Sheetsのデータは残ります）

**管理画面でできること**:
- 新規フォームの作成
- フォームのインポート/エクスポート
- フォームのアーカイブ/削除
- フォームの編集（フォーム名をクリック）
- 一覧の更新

### 5. 新しいフォームを作成する

#### Step 1: フォームの基本情報を設定

1. 管理画面で **「新規作成」** ボタンをクリック

![フォーム新規作成画面](screenshot_07_new_form_basic.png)

2. 以下の情報を入力します：
   - **フォーム名**: フォームの識別名（例: 「顧客満足度調査」）
   - **説明**: フォームの目的や概要（任意）
   - **Google Drive保存先URL**: フォームデータを保存するGoogle DriveのフォルダまたはファイルURL（オプション）
     - 例: `https://drive.google.com/drive/folders/1prBDiRinhAw2mRJir_1BwGv4tSINJc28`

#### Step 2: Google Sheetsと連携

フォームの回答を保存するGoogle Sheetsを設定します。

1. Google Sheetsで新しいスプレッドシートを作成
2. **Spreadsheet ID / URL** フィールドに以下のいずれかの形式で貼り付けます：
   - フルURL: `https://docs.google.com/spreadsheets/d/1Lj48NIuhyyc85MmrkxDjGnmTNQbxcAjUJf6Gu3faH-M/edit`
   - スプレッドシートID: `1Lj48NIuhyyc85MmrkxDjGnmTNQbxcAjUJf6Gu3faH-M`
3. **Sheet Name** を指定（デフォルト: `Responses`）

> **💡 ヒント**: スプレッドシートIDは、Google SheetsのURLの `/d/` と `/edit` の間にある長い文字列です（例: `1Lj48NIuhyyc85MmrkxDjGnmTNQbxcAjUJf6Gu3faH-M`）。

#### Step 3: 検索画面の設定

- **1画面あたりの表示件数**: 検索結果の1ページあたりの表示件数（デフォルト: 20）
- **検索結果テーブルの最大幅（px）**: テーブルの最大幅を指定（任意）
- **検索結果セルの表示文字数上限**: セル内の文字数上限を指定（任意）

#### フォーム編集画面の構成

フォーム管理画面でフォーム名をクリック、または「新規作成」を選択すると、フォーム編集画面が開きます。

**上部エリア：フォームの基本情報**
- **フォーム名**: フォームの表示名
- **フォームの説明**: フォームの概要説明
- **フォーム項目データのGoogle Drive保存先URL**: スプレッドシートの場所

**中央エリア：フォーム項目エディタ**
- **左側**: 質問項目の階層表示
- **右側**: 選択した項目の詳細設定

**下部ボタン**: 保存、キャンセル、プレビュー

**主な機能**:
1. 質問項目の追加・削除・並べ替え：左側の上下矢印で順序変更
2. 質問タイプの設定：テキスト、数値、日付、選択肢など
3. ネスト構造の設定：親質問に対する子質問の追加
4. 条件分岐の設定：選択肢に基づいて表示する子質問の指定

### 6. 質問を追加する

#### 基本的な質問の追加

1. フォームエディタ画面で **「質問を追加」** ボタンをクリック

![質問追加画面](screenshot_11_add_question.png)

2. 質問の設定項目が表示されます：
   - **項目名**: 質問文（例: 「お名前を教えてください」）
   - **タイプ**: 質問の種類を選択（下記参照）
   - **必須**: チェックを入れると回答必須になります
   - **表示**: 検索結果に表示するかどうか
   - **スタイル設定**: 文字サイズ・色のカスタマイズ
   - **プレースホルダー**: 入力欄に表示されるヒントテキスト

![質問詳細設定](screenshot_12_question_details.png)

#### 質問タイプの種類

![質問タイプドロップダウン](../.playwright-mcp/07_question_type_dropdown.png)

| タイプ | 説明 | 使用例 | 追加設定 |
|--------|------|--------|----------|
| **テキスト** | 1行の短いテキスト入力 | 名前、メールアドレス | プレースホルダー設定可 |
| **テキスト（複数行）** | 複数行の長文入力 | 意見、コメント | プレースホルダー設定可 |
| **数値** | 数字のみ入力可能 | 年齢、個数 | プレースホルダー設定可 |
| **日付** | 日付選択 | 誕生日、イベント日 | デフォルトで現在日付を設定可 |
| **時間** | 時刻選択 | 予約時間 | デフォルトで現在時刻を設定可 |
| **ラジオ** | 単一選択 | 性別、満足度 | 選択肢設定、選択肢ごとの子質問 |
| **チェックボックス** | 複数選択可能 | 趣味、興味のある分野 | 選択肢設定、選択肢ごとの子質問 |
| **ドロップダウン** | ドロップダウンから選択 | 都道府県 | 選択肢設定、選択肢ごとの子質問 |
| **正規表現** | カスタムバリデーション | 電話番号、郵便番号 | 正規表現パターン設定、プレースホルダー |
| **メッセージ** | 説明文の表示（入力不要） | 注意事項、セクション見出し | スタイル設定のみ |

#### スタイル設定機能

各質問に対して、以下のスタイルをカスタマイズできます：

![スタイル設定の詳細](../.playwright-mcp/08_style_settings_expanded.png)

- **文字サイズ**: 小 (12px) / 通常 (14px) / 大 (18px) / 特大 (24px)
- **文字色**: 黒（デフォルト）/ 赤 / 青 / 緑 / グレー

### 7. フォームをプレビューする

「プレビュー」ボタンをクリックすると、実際のフォームの見た目を確認できます。

![プレビュー画面](../.playwright-mcp/04_preview.png)

プレビュー画面では：
- フォームの見た目を確認
- テスト入力して動作確認
- 検索プレビューで表示項目を確認

### 8. フォームを保存する

1. すべての設定が完了したら **「保存」** ボタンをクリック
2. 確認メッセージが表示されます
3. 管理画面に戻り、フォーム一覧に追加されます

### 9. フォームを公開する

#### HTMLファイルとしてエクスポート

1. フォーム一覧でフォームのチェックボックスを選択
2. **「エクスポート」** ボタンをクリック
3. JSON形式のフォーム定義ファイルがダウンロードされます

#### 特徴
- フォーム設定をJSON形式で保存
- 他の環境にインポート可能
- バックアップとして利用可能

---

## 回答の管理

### 検索画面（データ検索・管理画面）

メイン画面でフォームカードをクリックすると、検索画面が表示されます。

![検索画面](screenshot_19_search_screen.png)

**画面の構成**:

**左側のナビゲーションペイン**:
- **戻る**: フォーム一覧ページに戻ります
- **新規入力**: 新しい回答を入力するフォーム入力画面を開きます
- **削除**: 選択されたレコードを削除します（複数選択可能）
- **更新**: データの表示を更新し、最新の情報を取得します

**メイン画面**:
- **キーワード検索**: 任意のキーワードで回答データを検索します
- **最終更新日時表示**: 現在表示されているデータの最終更新日時を示します
- **データテーブル**: 以下の列を含むテーブルで回答データを表示
  - チェックボックス: レコードを選択
  - No.: 回答の番号
  - 最終更新日時: 最後に更新された日時
  - フォームで定義された各質問項目

**検索画面でできること**:
- 回答データの一覧表示
- キーワード検索（基本検索・高度な検索）
- 新規入力
- 既存レコードの編集（レコードをクリック）
- レコードの削除（単一または複数）
- データの更新

### 新規入力（フォーム入力画面）

「新規入力」ボタンをクリックすると、フォーム入力画面が表示されます。

![フォーム入力画面](../.playwright-mcp/06_form_input.png)

#### 画面の構成

**左側のボタン**:
- **保存**: 入力または編集した内容を保存します
- **キャンセル**: 変更を破棄し、前のページに戻ります

**メイン画面**:
- フォーム設計時に定義された質問項目がフォーム形式で表示されます
- 各質問には以下のフィールドタイプが含まれます：
  - **テキスト入力**: 自由形式のテキスト入力フィールド
  - **数値入力**: 数値のみを入力可能なフィールド
  - **日付選択**: カレンダーから日付を選択できるフィールド
  - **時間選択**: 時刻を指定できるフィールド
  - **選択肢（ラジオボタン）**: 複数の選択肢から1つを選択
  - **チェックボックス**: 複数の選択肢から複数選択可能
  - **その他**: 正規表現によるバリデーション付きフィールド

**フォーム入力画面の特徴**:
- 自動生成された回答ID（編集不可）
- 設定したスタイル（文字色、サイズ）が適用
- メッセージタイプのフィールドは入力不要（情報表示のみ）
- 必須項目には「*」マークが表示されます
- ネスト構造や条件分岐により、選択肢に応じて関連する子質問が動的に表示または非表示になります

#### データ入力の手順

1. フォーム一覧から任意のフォームを選択します
2. **「新規入力」** ボタンをクリックします
3. 表示されたフォームに必要な情報を入力します
4. 必須項目（*マーク）はすべて入力必須です
5. すべての入力が完了したら **「保存」** ボタンをクリックします
6. 入力内容は自動的にGoogle Sheetsに保存されます

### 検索機能の使い方

#### シンプルなキーワード検索

検索ボックスにキーワードを入力すると、すべての列（全フィールド）を対象に検索が実行されます。

```
田中
```

このように入力すると、「田中」を含むすべてのレコードが検索結果に表示されます。

#### 列を指定した検索

特定の列だけを検索するには、`列名:キーワード` の形式で入力します。

```
名前:田中
```

#### 比較演算子を使った検索

数値や日付の範囲を指定できます。

| 演算子 | 意味 | 例 |
|--------|------|-----|
| `=` | 等しい | `年齢=25` |
| `!=` | 等しくない | `性別!=男性` |
| `>` | より大きい | `年齢>30` |
| `>=` | 以上 | `年齢>=18` |
| `<` | より小さい | `年齢<65` |
| `<=` | 以下 | `年齢<=20` |

#### AND/OR検索

複数の条件を組み合わせることができます。

```
年齢>=18 AND 年齢<=65
```

```
性別=男性 OR 性別=女性
```

#### 正規表現検索

パターンマッチングが可能です。

```
電話番号 ~ /^090/
```

> **詳細**: より高度な検索方法は `docs/検索機能の使い方.md` を参照してください。

### ソートとページネーション

- **ソート**: 列名をクリックして昇順/降順を切り替え
- **ページネーション**: 画面下部のページ番号で移動
- **表示件数**: 1ページあたりの表示件数を設定で変更可能

### レコードの編集

既存の回答データを編集することができます。

#### 編集手順

1. データ検索・管理画面のテーブルから、編集したいレコードをクリックします
2. フォーム入力画面が表示され、現在の値が読み込まれます
3. 必要な項目を修正します
4. **「保存」** ボタンをクリックして変更を確定します
5. 更新が完了すると、「最終更新日時」が自動的に更新されます

> 💡 **ヒント**: 編集時も新規入力時と同じバリデーションが適用されます。必須項目は必ず入力してください。

### レコードの削除

#### 単一レコードの削除

1. データ検索・管理画面のテーブルから、削除したいレコードの**左側のチェックボックス**を選択
2. 画面左側の **「削除」** ボタンをクリック
3. 確認ダイアログが表示されます
4. **「削除を確定」** を選択すると、選択されたレコードが削除されます

#### 複数レコードの一括削除

1. 削除したいレコードのチェックボックスを複数選択
2. 画面左側の **「削除」** ボタンをクリック
3. 確認ダイアログで **「削除を確定」** を選択

> ⚠️ **注意**: 削除したレコードは復元できませんので、慎重に操作してください。

---

## 操作ガイド：ステップバイステップ

このセクションでは、主要な操作を詳しく説明します。

### 4.1 新しいフォームを作成する

Nested Form Builderでは、管理画面からフォームを作成できます。

#### 手順

1. フォーム一覧画面に表示されている **「フォーム管理へ」** ボタンをクリックします
2. フォーム管理画面が開きます
3. 左側メニューの **「新規作成」** ボタンをクリックします
4. フォーム編集画面でビジュアルエディタを使って質問を追加・編集します

#### 各質問に対して設定可能な項目

- **質問テキスト**: ユーザーに表示される質問の内容
- **フィールドタイプ**: テキスト、数値、日付、時間、選択肢など
- **必須フラグ**: 入力を必須とするか選択
- **デフォルト値**: あらかじめ設定される初期値（日付・時間タイプ）
- **バリデーションルール**: 正規表現によるパターンチェック（正規表現タイプ）
- **プレースホルダー**: 入力欄に表示されるヒントテキスト

#### ネスト構造と条件分岐の追加

- **ネスト構造を追加する場合**: 親質問の **「次の質問を追加」** ボタンをクリックして子質問を追加します
- **条件分岐を設定する場合**: 選択肢ごとに **「子質問追加」** ボタンをクリックして、特定の選択肢が選ばれた場合にのみ表示される子質問を定義します

#### 保存

設計が完了したら、画面上部の **「保存」** ボタンをクリックしてフォームを保存します。

### 4.2 フォームにデータを入力する

作成したフォームにデータを入力する手順です。

#### 手順

1. フォーム一覧から入力したいフォームを選択します
2. データ検索・管理画面が開きます
3. 左側メニューの **「新規入力」** ボタンをクリックします
4. 表示されたフォームに必要な情報を入力します
5. 必須項目（*マーク）はすべて入力必須です
6. 選択肢に応じて、子質問が動的に表示されます
7. すべての入力が完了したら **「保存」** ボタンをクリックします
8. 入力内容は自動的にGoogle Sheetsに保存されます

> 💡 **ヒント**: 入力中に **「キャンセル」** ボタンをクリックすると、変更を破棄して前の画面に戻ります。

### 4.3 レコードを検索する

保存された回答データを検索する方法です。

#### シンプルなキーワード検索

データ検索・管理画面の検索フィールドにキーワードを入力して検索します。全フィールドを対象に検索が実行されます。

```
田中
```

#### 高度な検索（正規表現やフィルタリング）

より詳細な検索を行う場合は、以下の構文を使用できます：

**列指定検索**: `列名:値` の形式

```
名前:田中
```

**比較演算**: `列名>値`、`列名<=値` など

```
年齢>30
年齢>=18 AND 年齢<=65
```

**正規表現**: `列名 ~ /パターン/` の形式

```
電話番号 ~ /^090/
```

> 💡 **ヒント**: 高度な検索クエリの詳細は `docs/検索機能の使い方.md` を参照してください。

---

## フォームエディタの使い方

### 質問カードの属性と設定

各質問カードには、以下の属性を設定できます：

#### 基本属性

- **項目名（label）**: ユーザーに表示される質問のタイトル（必須）
- **タイプ（type）**: 質問の入力形式（テキスト、数値、日付など）
- **必須（required）**: チェックを入れると回答必須になります
- **表示（displayMode）**: 検索結果への表示方法を制御
  - **表示ON（normal）**: 検索結果テーブルに通常表示
  - **コンパクト（compact）**: 省スペースで表示（一部の質問タイプで利用可能）
  - **表示OFF（none）**: フォーム入力は可能だが、検索結果には表示されない

#### スタイル設定（showStyleSettings / styleSettings）

「スタイル設定」チェックボックスをオンにすると、以下の設定が可能：

- **文字サイズ（labelSize）**:
  - 小（smaller / 12px）
  - 通常（default / 14px）
  - 大（larger / 18px）
  - 特大（24px）
- **文字色（textColor）**: 黒（デフォルト）/ 赤 / 青 / 緑 / グレー

#### プレースホルダー設定（showPlaceholder / placeholder）

「プレースホルダー」チェックボックスをオンにすると、入力欄にヒントテキストを表示できます。

- **対応タイプ**: テキスト、テキスト（複数行）、数値、正規表現
- **例**: 「例: 03-1234-5678」「お名前を入力してください」

#### タイプ別の詳細設定

**日付・時間タイプの設定（defaultNow）**:
- デフォルトで現在の日付/時刻を自動入力するかどうかを設定できます
- フォーム入力時に自動的に現在の値が入ります

**正規表現タイプの設定（pattern）**:
- カスタムバリデーションパターンを設定できます
- 例: 電話番号 `^\d{2,4}-\d{2,4}-\d{4}$`、郵便番号 `^\d{3}-\d{4}$`
- パターンに一致しない入力はエラーとして扱われます

**選択肢タイプの設定（options / childrenByValue）**:
- ラジオ、チェックボックス、ドロップダウンでは選択肢を設定できます
- 各選択肢に対して、個別の子質問を追加できます（条件分岐）
- 選択肢ごとに異なるネスト構造を構築可能

#### 質問カードの操作ボタン

各質問カードには、以下の操作ボタンがあります：

- **削除**: その質問を削除します（取り消し不可）
- **次の質問を追加**: 現在の質問の後に新しい質問を追加します
- **↑上へ / ↓下へ**: 質問の表示順序を入れ替えます

> ⚠️ **注意**: 削除した質問は復元できません。子質問（ネストされた質問）も一緒に削除されます。

### 質問の編集

既存の質問を編集するには：

1. 質問カードで設定を変更
2. **「保存」** をクリック

### 次の質問を追加（ネスト構造と条件分岐）

特定の質問の後に、条件付きで表示される子質問を追加できます。

![ネスト構造の例](../.playwright-mcp/10_nested_question_added.png)

#### 基本的なネスト構造の追加

1. 親質問の **「次の質問を追加」** ボタンをクリック
2. 子質問の設定を入力
3. 必要に応じて、さらに孫質問を追加

#### 条件分岐（childrenByValue）の設定

選択肢タイプ（ラジオ、チェックボックス、ドロップダウン）では、**選択肢ごとに異なる子質問**を設定できます。

**設定手順**:
1. 親質問のタイプを「ラジオ」「チェックボックス」「ドロップダウン」のいずれかに設定
2. 「選択肢」セクションで選択肢を追加
3. 各選択肢の **「子質問追加」** ボタンをクリック
4. その選択肢が選ばれた場合にのみ表示される子質問を設定

**例**: 「好きな果物は？」という質問で：
- 選択肢「リンゴ」→ 子質問「どれくらい食べる？」
- 選択肢「みかん」→ 子質問「何個食べる？」（さらに選択肢を設定）
- 選択肢「ぶどう」→ 子質問なし

**動作**:
- ユーザーが「リンゴ」を選択した場合のみ、「どれくらい食べる？」が表示されます
- チェックボックスの場合、複数の選択肢に対応する子質問が同時に表示されます

#### ネストの特徴

- **最大6階層**まで質問をネスト可能
- 各階層で条件分岐を設定できます
- 条件に合わない場合、子質問は表示されません
- 条件分岐により、ユーザーの回答に応じて動的にフォームが変化します

### スタイル設定

「スタイル設定」チェックボックスをオンにすると、以下の設定が可能になります：

- **文字サイズ**: 小 (12px) / 通常 (14px) / 大 (18px) / 特大 (24px)
- **文字色**: 黒（デフォルト）/ 赤 / 青 / 緑 / グレー

例：年齢フィールドを赤色・通常サイズで表示

### プレースホルダー設定

「プレースホルダー」チェックボックスをオンにすると、入力欄にヒントテキストを表示できます。

![プレースホルダー設定](../.playwright-mcp/09_placeholder_settings.png)

### 選択肢の設定

ラジオボタン、チェックボックス、ドロップダウンの質問タイプでは、選択肢を設定できます。

![選択肢設定](../.playwright-mcp/11_radio_options_settings.png)

**選択肢設定の手順**:
1. 質問タイプで「ラジオ」「チェックボックス」「ドロップダウン」のいずれかを選択
2. 「選択肢」セクションが表示されます
3. **「選択肢を追加」** ボタンをクリックして選択肢を入力
4. 各選択肢に **「子質問追加」** ボタンが表示され、選択肢ごとに異なる子質問を追加可能
5. 不要な選択肢は **「削除」** ボタンで削除できます

---

## 高度な機能

### 表示モード

質問の「表示」チェックボックスで、検索結果への表示を制御できます。

- **表示ON**: 検索結果テーブルに表示される
- **表示OFF**: フォーム入力は可能だが、検索結果には表示されない

> **💡 用途**: 「表示OFF」は、自動計算される値やタイムスタンプなど、一覧表示が不要な項目に便利です。

### メッセージタイプ

「メッセージ」タイプを使用すると、入力不要の説明文やセクション見出しを表示できます。

**使用例**:
- セクションの区切り
- 注意事項の表示
- 説明文の挿入

### Google Drive連携

フォーム設定で「Google Drive保存先URL」を指定すると、回答データをGoogle Driveに保存できます。

**設定方法**:
- **空白**: ルートディレクトリに保存
- **フォルダURL**: そのフォルダにランダム名で保存
  - 例: `https://drive.google.com/drive/folders/1prBDiRinhAw2mRJir_1BwGv4tSINJc28`
- **ファイルURL**: 特定のファイルに保存
  - 例: `https://docs.google.com/spreadsheets/d/1Lj48NIuhyyc85MmrkxDjGnmTNQbxcAjUJf6Gu3faH-M/edit`

> **注意**: URLを変更すると新しい場所に保存され、元のファイルはそのまま残ります。

### スプレッドシートを開く

フォームエディタ画面の「📊 スプレッドシートを開く」ボタンをクリックすると、設定したGoogle Sheetsを直接開くことができます。

---

## フォームの管理

### フォームのエクスポート

1. フォーム一覧でエクスポートしたいフォームのチェックボックスを選択
2. **「エクスポート」** ボタンをクリック
3. JSON形式のファイルがダウンロードされます

### フォームのインポート

1. 管理画面で **「インポート」** ボタンをクリック
2. JSON形式のフォームファイルを選択
3. 既存のフォームと同じIDの場合、上書き確認が表示されます

### フォームのアーカイブ

使用しなくなったフォームをアーカイブできます。

1. フォーム一覧でアーカイブしたいフォームのチェックボックスを選択
2. **「アーカイブ」** ボタンをクリック
3. フォーム一覧から非表示になります

### フォームの削除

1. フォーム一覧で削除したいフォームのチェックボックスを選択
2. **「削除」** ボタンをクリック
3. 確認ダイアログで確認

> ⚠️ **注意**: 削除したフォームは復元できません。

---

## よくある質問

### Q1. フォームの回答はどこに保存されますか？

A: 設定したGoogle Sheetsに自動的に保存されます。スプレッドシートを開くと、以下の形式でデータが記録されています：

- **固定列**: `id`, `No.`, `createdAt`, `modifiedAt`
- **質問列**: 各質問の回答（ネストされた質問は `親質問|子質問` の形式）

### Q2. フォームの階層は何段階まで作成できますか？

A: 最大6階層までネスト可能です。それ以上の階層は作成できません。

### Q3. 回答者がインターネット接続なしでフォームに回答できますか？

A: いいえ、回答の送信にはインターネット接続が必要です。ただし、HTMLファイル自体はオフラインで開くことができます。

### Q4. 複数のフォームで同じGoogle Sheetsを使えますか？

A: 技術的には可能ですが、推奨しません。各フォームごとに専用のスプレッドシートを作成することをお勧めします。

### Q5. フォームのデザインをカスタマイズできますか？

A: スタイル設定機能で、フィールドごとに文字サイズと色をカスタマイズできます。より高度なカスタマイズは将来のバージョンで追加予定です。

### Q6. データをExcelにエクスポートできますか？

A: Google Sheetsから直接Excelファイル（.xlsx）をダウンロードできます：
1. Google Sheetsを開く
2. **ファイル** → **ダウンロード** → **Microsoft Excel (.xlsx)**

### Q7. パフォーマンスが遅いと感じたら？

A: 以下の最適化機能が実装されています：
- **IndexedDBキャッシュ**: フォームデータとレコードをローカルにキャッシュ
- **バックグラウンド更新**: キャッシュを使用しつつ、バックグラウンドで最新データを取得
- **パフォーマンスログ**: コンソールで `window.showPerfSummary()` を実行すると詳細を確認可能

---

## トラブルシューティング

### 問題: フォームが保存できない

**原因と解決方法**:
1. **フォーム名が空**: フォーム名を入力してください
2. **スプレッドシートIDが無効**: Google SheetsのURLを正しくコピーしているか確認
3. **ブラウザのストレージが満杯**: ブラウザのキャッシュをクリア
4. **Google Sheetsへの接続が正常か確認**: ネットワーク接続を確認
5. **設定で指定されているspreadsheetIdが正確か確認**: フォーム設定を再確認
6. **Google Apps Scriptにスプレッドシートへの書き込み権限があるか確認**: スプレッドシートの共有設定を確認
7. **ブラウザのコンソールでエラーメッセージを確認**: F12キーで開発者ツールを開いてエラーを確認

### 問題: 回答が Google Sheets に保存されない

**原因と解決方法**:
1. **スプレッドシートのアクセス権限がない**: スプレッドシートの共有設定を確認
2. **GAS Webアプリがデプロイされていない**: Google Apps Scriptをデプロイ
3. **スプレッドシートIDが正しくない**: 設定を再確認

### 問題: 検索結果が表示されない

**原因と解決方法**:
1. **スプレッドシートにデータがない**: 実際に回答が保存されているか確認
2. **検索クエリの構文エラー**: シンプルなキーワード検索で試してみる
3. **キャッシュが古い**: **「更新」** ボタンをクリック

### 問題: インポートしたフォームが正しく動作しない

**原因と解決方法**:
1. **JSONファイルが破損**: 元のファイルを再度エクスポート
2. **古いバージョンのフォーム**: 互換性の問題がある可能性があります
3. **必須フィールドが不足**: 少なくとも `schema` と `settings` が必要

### 問題: ブラウザが遅い・固まる

**原因と解決方法**:
1. **大量のフォームデータ**: 不要なフォームをアーカイブまたは削除
2. **ブラウザのメモリ不足**: ブラウザを再起動
3. **大量のレコード**: ページネーション設定を小さくする（10件/ページ）
4. **キャッシュのクリア**: ブラウザのIndexedDBをクリア

### 問題: テーマの変更が反映されない

**原因と解決方法**:
1. **ブラウザのキャッシュをクリアして再度アクセス**: 強制リロード（Ctrl+Shift+R または Cmd+Shift+R）
2. **IndexedDBのブラウザデータをクリア**: ブラウザ設定から
3. **別のブラウザで試してみる**: Chrome、Firefox、Edgeなど
4. **テーマ設定が正しく保存されているか確認**: ブラウザのローカルストレージを確認

### 問題: レコードが表示されない

**原因と解決方法**:
1. **「更新」ボタンをクリックして最新データを読み込み**: 左側メニューの「更新」ボタン
2. **キーワード検索フィールドが空になっているか確認**: 検索条件をクリア
3. **Google Sheetsのシート名が設定と一致しているか確認**: フォーム設定の「Sheet Name」を確認
4. **スプレッドシートのデータに実際にレコードが存在するか確認**: Google Sheetsを直接開いて確認

### 問題: カスタムテーマのインポートが失敗する

**原因と解決方法**:
1. **Google DriveのファイルURLが正確か確認**: URLフォーマット `https://drive.google.com/file/d/[FILE_ID]/view`
2. **CSSファイルに `:root[data-theme=\"テーマ名\"]` セレクタが含まれているか確認**: テーマ名が自動抽出されます
3. **Google Apps Scriptの実行権限でGoogle Driveへのアクセスが許可されているか確認**: 権限設定を確認
4. **ファイルが正しい形式のCSSであるか確認**: 構文エラーがないか確認

### 問題: デプロイ後にアクセスできない

**原因と解決方法**:
1. **デプロイ設定の確認**: Google Apps Script管理画面で「アクセスできるユーザー」を「全員」に設定
2. **ブラウザキャッシュのクリア**: 強制リロード（Ctrl+Shift+R または Cmd+Shift+R）
3. **デプロイURLの確認**: プロジェクトルートの `.gas-deployment.json` ファイルで最新のWebアプリURLを確認
   ```json
   {
     "deploymentId": "...",
     "webAppUrl": "https://script.google.com/macros/s/.../exec"
   }
   ```

---

## さらに詳しい情報

- **技術仕様書**: `docs/SPECIFICATIONS.md`（存在する場合）
- **検索機能の詳細**: `docs/検索機能の使い方.md`
- **開発者向けガイド**: `CLAUDE.md`

---

## サポート

問題が解決しない場合は、以下の情報を含めて開発チームにお問い合わせください：

- 使用しているブラウザとバージョン
- 発生している問題の詳細な説明
- エラーメッセージ（あれば）
- 問題が発生する手順

---

**最終更新**: 2026年2月15日
**作成**: Nested Form Builder Development Team
