# Nested Form Builder ユーザーマニュアル

**バージョン**: 1.0
**最終更新**: 2025年11月

---

## 目次

1. [はじめに](#はじめに)
2. [基本的な使い方](#基本的な使い方)
3. [フォームエディタの使い方](#フォームエディタの使い方)
4. [高度な機能](#高度な機能)
5. [回答の管理](#回答の管理)
6. [よくある質問](#よくある質問)
7. [トラブルシューティング](#トラブルシューティング)

---

## はじめに

### Nested Form Builderとは

Nested Form Builderは、階層構造を持つアンケートフォームを視覚的に作成できるWebアプリケーションです。プログラミングの知識がなくても、直感的な操作でフォームを作成し、回答をGoogle Sheetsに自動保存できます。

### 主な機能

- ✅ **ビジュアルエディタ**: ドラッグ&ドロップで簡単にフォームを作成
- ✅ **ネスト構造**: 条件に応じて次の質問を表示（最大6階層）
- ✅ **多様な質問タイプ**: テキスト、数値、日付、選択肢、チェックボックスなど
- ✅ **Google Sheets連携**: 回答を自動的にスプレッドシートに保存
- ✅ **スタンドアロンHTML出力**: 生成されたフォームは単一のHTMLファイルとして配布可能
- ✅ **高度な検索機能**: AND/OR検索、比較演算、正規表現をサポート
- ✅ **データ管理**: インポート・エクスポート、アーカイブ機能

### システム要件

- **ブラウザ**: Google Chrome、Firefox、Safari、Edge（最新版推奨）
- **Googleアカウント**: Google Sheetsにデータを保存するために必要
- **インターネット接続**: フォームの保存・取得時に必要

---

## 基本的な使い方

### 1. 初回起動

1. ブラウザでNested Form Builderにアクセスします
2. 管理画面（Admin Dashboard）が表示されます
3. 初回は「フォームがありません」と表示されます

### 2. 新しいフォームを作成する

#### Step 1: フォームの基本情報を設定

1. 管理画面で **「新規作成」** ボタンをクリック
2. 以下の情報を入力します：
   - **フォーム名**: フォームの識別名（例: 「顧客満足度調査」）
   - **説明**: フォームの目的や概要（任意）

#### Step 2: Google Sheetsと連携

フォームの回答を保存するGoogle Sheetsを設定します。

1. Google Sheetsで新しいスプレッドシートを作成
2. URLをコピーして、以下のいずれかの形式で貼り付けます：
   - フルURL: `https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/edit`
   - スプレッドシートID: `YOUR_SHEET_ID`
3. **シート名**を指定（デフォルト: `Responses`）

> **💡 ヒント**: スプレッドシートIDは、Google SheetsのURLの `/d/` と `/edit` の間にある長い文字列です。

#### Step 3: GAS WebアプリのURLを設定（デプロイ後）

Google Apps Scriptをデプロイした後、WebアプリのURLを設定します。

1. Google Apps Scriptプロジェクトをデプロイ
2. 生成されたWebアプリのURL（`https://script.google.com/macros/s/.../exec`）をコピー
3. フォーム設定の **「GAS URL」** フィールドに貼り付け

### 3. 質問を追加する

#### 基本的な質問の追加

1. フォームエディタ画面で **「質問を追加」** ボタンをクリック
2. 質問の設定項目が表示されます：
   - **ラベル**: 質問文（例: 「お名前を教えてください」）
   - **タイプ**: 質問の種類を選択（下記参照）
   - **必須**: チェックを入れると回答必須になります
   - **プレースホルダー**: 入力欄に表示されるヒントテキスト

#### 質問タイプの種類

| タイプ | 説明 | 使用例 |
|--------|------|--------|
| **テキスト** | 1行の短いテキスト入力 | 名前、メールアドレス |
| **テキストエリア** | 複数行の長文入力 | 意見、コメント |
| **数値** | 数字のみ入力可能 | 年齢、個数 |
| **日付** | 日付選択 | 誕生日、イベント日 |
| **時刻** | 時刻選択 | 予約時間 |
| **ラジオボタン** | 単一選択 | 性別、満足度 |
| **チェックボックス** | 複数選択可能 | 趣味、興味のある分野 |
| **プルダウン** | ドロップダウンから選択 | 都道府県 |
| **正規表現** | カスタムバリデーション | 電話番号、郵便番号 |
| **メッセージ** | 説明文の表示（入力不要） | 注意事項、セクション見出し |

### 4. 質問の順序を変更する

- 質問の **上下矢印ボタン** をクリックして順序を変更
- または、ドラッグ&ドロップで並び替え（実装されている場合）

### 5. フォームを保存する

1. すべての設定が完了したら **「保存」** ボタンをクリック
2. 確認メッセージが表示されます
3. 管理画面に戻り、フォーム一覧に追加されます

### 6. フォームをプレビューする

1. フォーム一覧で **「プレビュー」** ボタンをクリック
2. 実際のフォームの見た目を確認できます
3. テスト入力して動作を確認しましょう

### 7. フォームを公開する

#### HTMLファイルとしてエクスポート

1. フォーム一覧で **「エクスポート」** ボタンをクリック
2. スタンドアロンHTMLファイルがダウンロードされます
3. このHTMLファイルを配布・共有できます

#### 特徴
- JavaScriptとCSSがすべて埋め込まれた単一ファイル
- インターネット接続があれば、どこでも動作
- 回答は設定したGoogle Sheetsに自動保存

---

## フォームエディタの使い方

### 質問の編集

既存の質問を編集するには：

1. 質問カードの **「編集」** アイコンをクリック
2. 項目を変更
3. **「保存」** をクリック

### 質問の削除

1. 質問カードの **「削除」** アイコンをクリック
2. 確認ダイアログで **「削除」** を選択

> ⚠️ **注意**: 削除した質問は復元できません。子質問（ネストされた質問）も一緒に削除されます。

### 質問のコピー

1. 質問カードの **「コピー」** アイコンをクリック
2. 同じ設定の質問が複製されます
3. 必要に応じてラベルなどを変更

### 選択肢の設定（ラジオボタン・チェックボックス・プルダウン）

1. 質問タイプで「ラジオボタン」「チェックボックス」「プルダウン」を選択
2. **「選択肢」** フィールドに選択肢を入力
3. 各選択肢は改行またはカンマ区切りで入力
   - 例: `はい\nいいえ\nわからない`
   - 例: `男性, 女性, その他`

### 正規表現バリデーション

特定の形式での入力を強制したい場合：

1. 質問タイプで **「正規表現」** を選択
2. **「パターン」** フィールドに正規表現を入力
   - 例（電話番号）: `^0\d{1,4}-?\d{1,4}-?\d{4}$`
   - 例（郵便番号）: `^\d{3}-?\d{4}$`
   - 例（メールアドレス）: `^[^\s@]+@[^\s@]+\.[^\s@]+$`

> **💡 ヒント**: 正規表現が分からない場合は、テキストタイプを使用してください。

---

## 高度な機能

### ネスト構造（条件分岐）

特定の回答に応じて次の質問を表示する機能です。

#### 例: 「はい」を選択した場合のみ詳細を聞く

1. **親質問**を作成：
   - ラベル: 「過去にサービスを利用したことがありますか？」
   - タイプ: ラジオボタン
   - 選択肢: `はい, いいえ`

2. 親質問の **「子質問を追加」** ボタンをクリック

3. **条件を設定**：
   - **「値による分岐」** を有効にする
   - **「表示条件の値」**: `はい`

4. **子質問**を作成：
   - ラベル: 「どのサービスを利用しましたか？」
   - タイプ: テキスト

これで、「はい」を選択した場合のみ、次の質問が表示されます。

#### ネストの特徴

- **最大6階層**まで質問をネスト可能
- 各階層で条件分岐を設定できます
- 条件に合わない場合、子質問は表示されません

### 表示モード

質問の表示方法を3つのモードから選択できます。

| モード | 説明 |
|--------|------|
| **通常** (normal) | 標準的な表示 |
| **コンパクト** (compact) | 余白を減らしたコンパクト表示 |
| **非表示** (none) | 検索画面には表示されるが、フォームには非表示 |

#### 設定方法

1. 質問の編集画面で **「表示モード」** を選択
2. モードを選んで保存

> **💡 用途**: 「非表示」モードは、自動計算される値やタイムスタンプなど、ユーザーが入力しない項目に便利です。

### 重要フィールドの設定

検索画面で優先的に表示したいフィールドを設定できます。

1. フォーム設定画面で **「重要フィールド」** セクションを開く
2. 表示したい質問のパスを選択
3. 検索結果の一覧に、これらのフィールドが表示されます

---

## 回答の管理

### 回答データの確認

1. 管理画面でフォームを選択
2. **「検索」** ボタンをクリック
3. すべての回答が一覧表示されます

### 検索機能の使い方

#### 基本的なキーワード検索

検索ボックスにキーワードを入力すると、すべての列から一致するデータを検索します。

```
田中
```

#### 列を指定した検索

特定の列だけを検索するには、`列名:キーワード` の形式で入力します。

```
名前:田中
```

#### 比較演算子を使った検索

数値や日付の範囲を指定できます。

| 演算子 | 意味 | 例 |
|--------|------|-----|
| `=` | 等しい | `年齢=25` |
| `!=` | 等しくない | `性別!=男性` |
| `>` | より大きい | `年齢>30` |
| `>=` | 以上 | `年齢>=18` |
| `<` | より小さい | `年齢<65` |
| `<=` | 以下 | `年齢<=20` |

#### AND/OR検索

複数の条件を組み合わせることができます。

```
年齢>=18 AND 年齢<=65
```

```
性別=男性 OR 性別=女性
```

#### 正規表現検索

パターンマッチングが可能です。

```
電話番号 ~ /^090/
```

> **詳細**: より高度な検索方法は `docs/検索機能の使い方.md` を参照してください。

### ソートとページネーション

- **ソート**: 列名をクリックして昇順/降順を切り替え
- **ページネーション**: 画面下部のページ番号で移動
- **表示件数**: 1ページあたりの表示件数を変更可能（10, 25, 50, 100件）

### レコードの編集

1. 検索結果から編集したいレコードの **「編集」** ボタンをクリック
2. フォーム画面が開き、既存のデータが読み込まれます
3. 変更を加えて **「送信」** をクリック
4. データが更新されます

### レコードの削除

#### 単一レコードの削除

1. 検索結果から削除したいレコードの **「削除」** ボタンをクリック
2. 確認ダイアログで **「削除」** を選択

#### 複数レコードの一括削除

1. 削除したいレコードのチェックボックスを選択
2. 画面上部の **「選択項目を削除」** ボタンをクリック
3. 確認ダイアログで **「削除」** を選択

> ⚠️ **注意**: 削除したデータは復元できません。

---

## フォームの管理

### フォームのエクスポート

#### 単一フォームのエクスポート

1. フォーム一覧で **「エクスポート」** ボタンをクリック
2. JSON形式のファイルがダウンロードされます

#### 複数フォームの一括エクスポート

1. エクスポートしたいフォームのチェックボックスを選択
2. **「選択項目をエクスポート」** ボタンをクリック
3. ZIP形式のファイルがダウンロードされます

### フォームのインポート

1. 管理画面で **「インポート」** ボタンをクリック
2. JSON形式のフォームファイルを選択
3. 既存のフォームと同じIDの場合、上書き確認が表示されます

#### インポートオプション

- **スキップ**: 既存のフォームを保持し、新規フォームのみインポート
- **上書き**: 既存のフォームを新しいデータで置き換え

### フォームのアーカイブ

使用しなくなったフォームをアーカイブできます。

1. フォーム一覧でアーカイブしたいフォームの **「アーカイブ」** ボタンをクリック
2. フォーム一覧から非表示になります

#### アーカイブの解除

1. 管理画面で **「アーカイブ済みを表示」** チェックボックスをオン
2. アーカイブされたフォームが表示されます
3. **「アーカイブ解除」** ボタンをクリック

### フォームの複製

既存のフォームをコピーして新しいフォームを作成できます。

1. フォーム一覧で **「複製」** ボタンをクリック
2. 同じ設定のフォームが作成されます
3. 必要に応じて名前や設定を変更

---

## よくある質問

### Q1. フォームの回答はどこに保存されますか？

A: 設定したGoogle Sheetsに自動的に保存されます。スプレッドシートを開くと、以下の形式でデータが記録されています：

- **固定列**: `id`, `No.`, `createdAt`, `modifiedAt`
- **質問列**: 各質問の回答（ネストされた質問は `親質問|子質問` の形式）

### Q2. フォームの階層は何段階まで作成できますか？

A: 最大6階層までネスト可能です。それ以上の階層は作成できません。

### Q3. 回答者がインターネット接続なしでフォームに回答できますか？

A: いいえ、回答の送信にはインターネット接続が必要です。ただし、HTMLファイル自体はオフラインで開くことができます。

### Q4. 複数のフォームで同じGoogle Sheetsを使えますか？

A: 技術的には可能ですが、推奨しません。各フォームごとに専用のスプレッドシートを作成することをお勧めします。

### Q5. フォームのデザインをカスタマイズできますか？

A: 現在、デザインのカスタマイズ機能は限定的です。将来のバージョンで追加予定です。

### Q6. データをExcelにエクスポートできますか？

A: Google Sheetsから直接Excelファイル（.xlsx）をダウンロードできます：
1. Google Sheetsを開く
2. **ファイル** → **ダウンロード** → **Microsoft Excel (.xlsx)**

### Q7. フォームの公開URLを作成できますか？

A: 現在、HTMLファイルのダウンロードのみサポートしています。ファイルをWebサーバーにアップロードすることで公開できます。

---

## トラブルシューティング

### 問題: フォームが保存できない

**原因と解決方法**:
1. **フォーム名が空**: フォーム名を入力してください
2. **スプレッドシートIDが無効**: Google SheetsのURLを正しくコピーしているか確認
3. **ブラウザのストレージが満杯**: ブラウザのキャッシュをクリア

### 問題: 回答が Google Sheets に保存されない

**原因と解決方法**:
1. **GAS URLが設定されていない**: フォーム設定でGAS URLを確認
2. **スプレッドシートのアクセス権限がない**: スプレッドシートの共有設定を確認
3. **GAS Webアプリがデプロイされていない**: Google Apps Scriptをデプロイ

#### GAS Webアプリのデプロイ手順

1. Google Apps Scriptプロジェクトを開く
2. **デプロイ** → **新しいデプロイ**
3. **種類の選択** → **ウェブアプリ**
4. **アクセスできるユーザー**: 「全員」を選択
5. **デプロイ** をクリック
6. 生成されたURLをフォーム設定に貼り付け

### 問題: 検索結果が表示されない

**原因と解決方法**:
1. **スプレッドシートにデータがない**: 実際に回答が保存されているか確認
2. **検索クエリの構文エラー**: シンプルなキーワード検索で試してみる
3. **キャッシュが古い**: **「再読込」** ボタンをクリック

### 問題: インポートしたフォームが正しく動作しない

**原因と解決方法**:
1. **JSONファイルが破損**: 元のファイルを再度エクスポート
2. **古いバージョンのフォーム**: 互換性の問題がある可能性があります
3. **必須フィールドが不足**: 少なくとも `schema` と `settings` が必要

### 問題: ブラウザが遅い・固まる

**原因と解決方法**:
1. **大量のフォームデータ**: 不要なフォームをアーカイブまたは削除
2. **ブラウザのメモリ不足**: ブラウザを再起動
3. **大量のレコード**: ページネーション設定を小さくする（10件/ページ）

### 問題: デプロイ後にアクセスできない

**原因と解決方法**:
1. **デプロイ設定の確認**: Google Apps Script管理画面で「アクセスできるユーザー」を「全員」に設定
2. **ブラウザキャッシュのクリア**: 強制リロード（Ctrl+Shift+R または Cmd+Shift+R）
3. **デプロイIDの確認**: `.gas-deployment.json` で最新のデプロイIDを確認

---

## さらに詳しい情報

- **技術仕様書**: `docs/SPECIFICATIONS.md`
- **検索機能の詳細**: `docs/検索機能の使い方.md`
- **開発者向けガイド**: `CLAUDE.md`

---

## サポート

問題が解決しない場合は、以下の情報を含めて開発チームにお問い合わせください：

- 使用しているブラウザとバージョン
- 発生している問題の詳細な説明
- エラーメッセージ（あれば）
- 問題が発生する手順

---

**最終更新**: 2025年11月
**作成**: Nested Form Builder Development Team
